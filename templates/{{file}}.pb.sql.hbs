{{#*inline "create_table"}}
CREATE TABLE {{snake @name}} {
	{{> @partial-block}}
};
{{/inline}}

{{#*inline "alter_table"}}
ALTER TABLE {{snake @mname}} {
	{{> @partial-block}}
};
{{/inline}}

{{#*inline "delete_table"}}
DELETE TABLE {{snake @name}};
{{/inline}}

{{~#*inline "type"}}
	{{~#eq @type "string"}}VARCHAR{{/eq}}
	{{~#eq @type "(uint|int|fixed|sfixed)32"}}INTEGER{{/eq}}
	{{~#eq @type "(uint|int|fixed|sfixed)64"}}BIGINT{{/eq}}
	{{~#eq @type "message"}}INTEGER{{/eq}}
	{{~#eq @type "enum"}}INTEGER{{/eq}}
	{{~#eq @type "bytes"}}VARBINARY{{/eq}}
{{~/inline}}

{{#*inline "create_column"}}
	CREATE COLUMN {{snake @field.name}} {{> type}};
{{/inline}}

{{#*inline "add_column"}}
	ADD COLUMN {{snake @field.name}};
{{/inline}}

{{#*inline "drop_column"}}
	DROP COLUMN {{snake @field.name}};
{{/inline}}

file: {{@name}}
{{#package}}
  file package: {{@name}}
  {{#with @root}}
    {{#package name=@package.name diff="v1" recursive=true}}
      package iterated: {{@name}} {{#if @old}}old{{else if @new}}new{{/if}}
      {{#file name=@file.name}}
    	  {{#message recursive=true}}
          message: {{@name}} {{#if @old}}old{{else if @new}}new{{/if}}
    	  	{{#if @created}}
    	  		{{#> create_table}}
    	  			{{#field}}
    	  				{{~> create_column}}
    	  			{{/field}}
    	  		{{/create_table}}
    	  	{{else if @deleted}}
    	  		{{~> delete_table}}
    	  	{{else if @updated}}
    	  		{{#> alter_table}}
    	  			{{#field}}
    	  				{{#if @created}}
    	  					{{~> add_column}}
    	  				{{else if @deleted}}
    	  					{{~> drop_column}}
    	  				{{/if}}
    	  			{{/field}}
    	  		{{/alter_table}}
    	  	{{/if}}
    	  {{/message}}
      {{/file}}
    {{/package}}
  {{/with}}
{{/package}}
